# Обновление с версии 2.0

> Если вы ещё не работали с Yii 2.0, этот раздел можно пропустить и сразу перейти к разделу "[Начало работы](../start/prerequisites.md)".

Несмотря на общие идеи и ценности, Yii3 концептуально отличается от Yii
2.0. Простого пути обновления нет, поэтому сначала [ознакомьтесь с политикой
поддержки и сроками окончания жизненного цикла Yii
2.0](https://www.yiiframework.com/release-cycle) и подумайте о том, чтобы
начинать новые проекты на Yii3, продолжая поддерживать существующие на Yii
2.0.

## Требования к PHP

Yii3 требует PHP версии 8.2 или выше. В связи с этим в фреймворке
используются языковые возможности, отсутствовавшие в Yii 2.0:

- [Объявления
  типов](https://www.php.net/manual/ru/functions.arguments.php#functions.arguments.type-declaration)
- [Объявления типов возвращаемых
  значений](https://www.php.net/manual/ru/functions.returning-values.php#functions.returning-values.type-declaration)
- [Видимость констант
  класса](https://www.php.net/manual/ru/language.oop5.constants.php)
- [Именованные
  аргументы](https://www.php.net/manual/ru/functions.arguments.php#functions.named-arguments)
- [Анонимные
  классы](https://www.php.net/manual/ru/language.oop5.anonymous.php)
- [::class](https://www.php.net/manual/ru/language.oop5.basic.php#language.oop5.basic.class.class)
- [Генераторы](https://www.php.net/manual/ru/language.generators.php)
- [Функции с переменным числом
  аргументов](https://www.php.net/manual/ru/functions.arguments.php#functions.variable-arg-list)
- [Readonly-свойства](https://www.php.net/manual/ru/language.oop5.properties.php#language.oop5.properties.readonly-properties)
- [Readonly-классы](https://www.php.net/manual/ru/language.oop5.basic.php#language.oop5.basic.class.readonly)
- [Продвижение свойств из
  конструктора](https://www.php.net/manual/ru/language.oop5.decon.php#language.oop5.decon.constructor.promotion)
- [Атрибуты](https://www.php.net/manual/ru/language.attributes.php)

## Предварительный рефакторинг

Перед переносом проекта с Yii 2.0 на Yii3 рекомендуется выполнить
рефакторинг. Это упростит процесс переноса и принесёт пользу проекту на
этапе, когда он ещё не переведён на Yii3.

### Используйте DI вместо сервис-локатора

Поскольку Yii3 требует явного внедрения зависимостей, рекомендуется заранее подготовиться и перейти от использования 
сервис-локатора (`Yii::$app->`) к использованию [DI-контейнера](https://www.yiiframework.com/doc/guide/2.0/ru/concept-di-container).

Если использование DI-контейнера по какой-либо причине затруднено, рассмотрите возможность переноса всех вызовов `Yii::$app->` в контроллеры и 
виджеты, передавая зависимости вручную от контроллера к объектам, которые их используют.

Подробное объяснение концепции представлено в [Внедрение зависимостей и
контейнер внедрения зависимостей](../concept/di-container.md).

### Используйте репозитории для получения данных

Поскольку Active Record не является единственным способом работы с базой
данных в Yii3, рекомендуется внедрить репозитории, которые будут скрывать
детали получения данных и объединять их в одном месте. Впоследствии их можно
будет переработать:

```php
final readonly class PostRepository
{
    public function getArchive()
    {
        // ...
    }
    
    public function getTop10ForFrontPage()
    {
        // ...
    }

}
```

### Отделите доменный слой от инфраструктуры

Если у вас сложная предметная область, рекомендуется отделить её от
инфраструктуры, предоставляемой фреймворком, чтобы вся бизнес-логика
находилась во фреймворк-независимых классах.

### Перенесите больше в компоненты

Сервисы Yii3 концептуально похожи на компоненты Yii 2.0, поэтому
рекомендуется перемещать повторно используемые части приложения в
компоненты.

## Что стоит изучить

### Docker

Шаблоны приложений по умолчанию используют
[Docker](https://www.docker.com/get-started/) для запуска. Рекомендуется
изучить как с ним работать, и применять его в своих проектах, поскольку он
даёт множество преимуществ:

1. Точно такое же окружение, как и в продакшене.
2. Не нужно устанавливать ничего, кроме самого Docker.
3. Окружение — на уровне приложения, а не сервера.

### Переменные окружения

Шаблоны приложений Yii3 используют [переменные
окружения](https://en.wikipedia.org/wiki/Environment_variable) для настройки
частей приложения. Эта концепция [очень удобна для приложений, работающих в
Docker](https://12factor.net/), но может быть непривычна пользователям Yii
1.1 и Yii 2.0.

### Действия

В отличие от Yii 2.0, Yii3 не требует контроллеров. Вместо них используются
[Действия](../structure/action.md), которые могут быть любыми вызываемыми
объектами. Их можно организовать в контроллеры, как в Yii 2, но это не
обязательно.

### Структура приложения

Предлагаемая структура приложения Yii3 отличается от Yii 2.0. Она описана в
разделе [структура приложения](../structure/overview.md).

Несмотря на это, Yii3 остаётся гибким, поэтому всё ещё возможно использовать
структуру, аналогичную Yii 2.0.
