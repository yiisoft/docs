# Russian translations for PACKAGE package
# Copyright (C) 2025 Free Software Foundation, Inc.
# This file is distributed under the same license as the PACKAGE package.
# Automatically generated, 2025.
#
msgid ""
msgstr ""
"Project-Id-Version: \n"
"POT-Creation-Date: 2026-01-24 08:55+0000\n"
"PO-Revision-Date: 2026-01-27 22:23+0300\n"
"Last-Translator: Automatically generated\n"
"Language-Team: none\n"
"Language: ru\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=3; plural=(n%10==1 && n%100!=11 ? 0 : n%10>=2 && n%10<=4 && (n%100<10 || n%100>=20) ? 1 : 2);\n"
"X-Generator: Poedit 3.8\n"

#. type: Fenced code block (sh)
#: ../src/guide/databases/db-migrations.md ../src/guide/start/databases.md
#, no-wrap
msgid "make composer require yiisoft/db-migration\n"
msgstr ""

#. type: Fenced code block (php)
#: ../src/guide/databases/db-migrations.md ../src/guide/start/databases.md
#, no-wrap
msgid ""
"'yiisoft/db-migration' => [\n"
"    'newMigrationNamespace' => 'App\\\\Migration',\n"
"    'sourceNamespaces' => ['App\\\\Migration'],\n"
"],\n"
msgstr ""

#. type: Title #
#: ../src/guide/index.md ../src/guide/start/databases.md
#, no-wrap
msgid "Working with databases"
msgstr "Работа с базами данных"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Yii doesn't dictate using a particular database or storage for your application.  There are many ways you can work with relational databases:"
msgstr "Yii не требует использования конкретной базы данных или хранилища для вашего приложения. Существует множество способов работы с реляционными базами данных:"

#. type: Bullet: '- '
#: ../src/guide/start/databases.md
msgid "[Yii DB](https://github.com/yiisoft/db)"
msgstr ""

#. type: Bullet: '- '
#: ../src/guide/start/databases.md
msgid "[Yii Active Record](https://github.com/yiisoft/active-record)"
msgstr ""

#. type: Bullet: '- '
#: ../src/guide/start/databases.md
msgid "[Cycle](https://github.com/cycle) via [Yii Cycle package](https://github.com/yiisoft/yii-cycle)"
msgstr "[Cycle](https://github.com/cycle) через [пакет Yii Cycle](https://github.com/yiisoft/yii-cycle)"

#. type: Bullet: '- '
#: ../src/guide/start/databases.md
msgid "[Doctrine](https://www.doctrine-project.org/) via [Yii Doctrine package](https://github.com/stargazer-team/yii-doctrine)"
msgstr "[Doctrine](https://www.doctrine-project.org/) через [пакет Yii Doctrine](https://github.com/stargazer-team/yii-doctrine)"

#. type: Bullet: '- '
#: ../src/guide/start/databases.md
msgid "[PDO](https://www.php.net/manual/en/book.pdo.php)"
msgstr "[PDO](https://www.php.net/manual/ru/book.pdo.php)"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "For non-relational ones, there are usually official libraries available:"
msgstr "Для нереляционных баз данных обычно доступны официальные библиотеки:"

#. type: Bullet: '- '
#: ../src/guide/start/databases.md
msgid "[ElasticSearch](https://github.com/elastic/elasticsearch-php)"
msgstr ""

#. type: Bullet: '- '
#: ../src/guide/start/databases.md
msgid "[Redis](https://redis.io/docs/latest/develop/clients/php/)"
msgstr ""

#. type: Bullet: '    - '
#: ../src/guide/start/databases.md ../src/internals/000-packages.md
msgid "..."
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "In this guide, we will focus on working with relational databases using Yii DB. We'll use PostgreSQL to implement a simple CRUD (create read update delete)."
msgstr "В этом руководстве мы сосредоточимся на работе с реляционными базами данных с помощью Yii DB. Мы будем использовать PostgreSQL для реализации простого CRUD (создание, чтение, обновление, удаление)."

#. type: Title ##
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Installing PostgreSQL"
msgstr "Установка PostgreSQL"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "You need to install PostgreSQL. If you prefer not to use Docker, [get the installer from official website](https://www.postgresql.org/download/), install it and create a database."
msgstr "Необходимо установить PostgreSQL. Если вы предпочитаете не использовать Docker, [загрузите установщик с официального сайта](https://www.postgresql.org/download/), установите его и создайте базу данных."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "If you use Docker, it is a bit simpler. Modify `docker/dev/compose.yml`:"
msgstr "При использовании Docker всё немного проще. Измените файл `docker/dev/compose.yml`:"

#. type: Fenced code block (yaml)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"services:\n"
"    app:\n"
"        build:\n"
"            dockerfile: docker/Dockerfile\n"
"            context: ..\n"
"            target: dev\n"
"            args:\n"
"                USER_ID: ${UID}\n"
"                GROUP_ID: ${GID}\n"
"        env_file:\n"
"            -   path: ./dev/.env\n"
"            -   path: ./dev/override.env\n"
"                required: false\n"
"        ports:\n"
"            - \"${DEV_PORT:-80}:80\"\n"
"        volumes:\n"
"            - ../:/app\n"
"            - ../runtime:/app/runtime\n"
"            - caddy_data:/data\n"
"            - caddy_config:/config\n"
"        tty: true\n"
"        depends_on:\n"
"            db:\n"
"                condition: service_healthy\n"
"\n"
"    db:\n"
"        image: postgres:${POSTGRES_VERSION:-15}-alpine\n"
"        environment:\n"
"            POSTGRES_DB: app\n"
"            POSTGRES_PASSWORD: password\n"
"            POSTGRES_USER: user\n"
"        volumes:\n"
"            - ../runtime/db:/var/lib/postgresql/data:rw\n"
"        ports:\n"
"            - \"${DEV_DB_PORT:-5432}:5432\"\n"
"        healthcheck:\n"
"            test: [ \"CMD-SHELL\", \"pg_isready -U user -d app\" ]\n"
"            interval: 5s\n"
"            timeout: 5s\n"
"            retries: 5\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Note that we add `depends_on` so application waits for database to be up."
msgstr "Обратите внимание, что мы добавляем `depends_on`, чтобы приложение ждало запуска базы данных."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Also, we'll need a `pdo_pgsql` extension to communicate with PostgreSQL. You can enable it locally in `php.ini`.  If you use Docker, check `docker/Dockerfile` and add `pdo_pgsql` in `install-php-extensions` list. Then rebuild PHP image with `make build && make down && make up`."
msgstr "Также потребуется расширение `pdo_pgsql` для взаимодействия с PostgreSQL. Его можно включить локально в файле `php.ini`. При использовании Docker проверьте файл `docker/Dockerfile` и добавьте `pdo_pgsql` в список `install-php-extensions`. Затем пересоберите образ PHP командой `make build && make down && make up`."

#. type: Title ##
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Configuring connection"
msgstr "Настройка подключения"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Now that we have the database, it's time to define the connection."
msgstr "Теперь, когда у нас есть база данных, пришло время определить подключение."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "First we need a package to be installed:"
msgstr "Сначала нам нужно установить пакет:"

#. type: Fenced code block (sh)
#: ../src/guide/start/databases.md
#, no-wrap
msgid "make composer require yiisoft/db-pgsql\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Now create `config/common/di/db-pgsql.php`:"
msgstr "Теперь создайте файл `config/common/di/db-pgsql.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"use Yiisoft\\Db\\Connection\\ConnectionInterface;\n"
"use Yiisoft\\Db\\Pgsql\\Connection;\n"
"use Yiisoft\\Db\\Pgsql\\Driver;\n"
"\n"
"/** @var array $params */\n"
"\n"
"return [\n"
"    ConnectionInterface::class => [\n"
"        'class' => Connection::class,\n"
"        '__construct()' => [\n"
"            'driver' => new Driver(\n"
"                $params['yiisoft/db-pgsql']['dsn'],\n"
"                $params['yiisoft/db-pgsql']['username'],\n"
"                $params['yiisoft/db-pgsql']['password'],\n"
"            ),\n"
"        ],\n"
"    ],\n"
"];\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "And define parameters in `config/common/params.php`. For Docker that would be:"
msgstr "Определите параметры в файле `config/common/params.php`. Для Docker это будет:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"use Yiisoft\\Db\\Pgsql\\Dsn;\n"
"\n"
"return [\n"
"    // ...\n"
"    'yiisoft/db-pgsql' => [\n"
"        'dsn' => new Dsn('pgsql', 'db', 'app', '5432'),\n"
"        'username' => 'user',\n"
"        'password' => 'password',\n"
"    ],\n"
"];\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "`db` host is resolved automatically within the Docker network."
msgstr "Хост `db` автоматически разрешается внутри сети Docker."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "For local installation without Docker the host in Dsn would be `localhost`. You'll have to adjust the rest to match how you configured the database."
msgstr "Для локальной установки без Docker хост в Dsn будет `localhost`. Остальные параметры необходимо настроить в соответствии с конфигурацией вашей базы данных."

#. type: Title ##
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Creating and applying migrations"
msgstr "Создание и применение миграций"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "For the initial state of the application and for further database changes, it is a good idea to use migrations.  These are files that create database changes. Applied migrations are tracked in the database, allowing us to know the current state and which migrations remain to be applied."
msgstr "Для начальной настройки приложения и для дальнейших изменений базы данных рекомендуется использовать миграции. Это файлы, которые описывают изменения в структуре базы данных. Примененные миграции отслеживаются в базе данных, что позволяет отслеживать текущее состояние и определять, какие миграции еще необходимо применить."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "To use migrations we need another package installed:"
msgstr "Для использования миграций нам нужно установить еще один пакет:"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Create a directory to store migrations `src/Migration` right in the project root. Add the following configuration to `config/common/params.php`:"
msgstr "Создайте каталог для хранения миграций `src/Migration` в корневой директории проекта. Добавьте следующую конфигурацию в файл `config/common/params.php`:"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Now you can use `make yii migrate:create page` to create a new migration. For our example we need a `page` table with some columns:"
msgstr "Теперь можно использовать команду `make yii migrate:create page` для создания новой миграции. Для нашего примера необходима таблица `page` с несколькими столбцами:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"namespace App\\Migration;\n"
"\n"
"use Yiisoft\\Db\\Migration\\MigrationBuilder;\n"
"use Yiisoft\\Db\\Migration\\RevertibleMigrationInterface;\n"
"\n"
"final class M251102141707Page implements RevertibleMigrationInterface\n"
"{\n"
"    public function up(MigrationBuilder $b): void\n"
"    {\n"
"        $column = $b->columnBuilder();\n"
"\n"
"        $b->createTable('page', [\n"
"            'id' => $column::uuidPrimaryKey(),\n"
"            'title' => $column::string()->notNull(),\n"
"            'slug' => $column::string()->notNull()->unique(),\n"
"            'text' => $column::text()->notNull(),\n"
"            'created_at' => $column::dateTime(),\n"
"            'updated_at' => $column::dateTime(),\n"
"        ]);\n"
"    }\n"
"\n"
"    public function down(MigrationBuilder $b): void\n"
"    {\n"
"        $b->dropTable('page');\n"
"    }\n"
"}\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "The `M251102141707Page` name of the migration class is generated so replace the `Page` suffix with the actual migration name. The `M251102141707` prefix is needed to find and sort migrations in the order they were added."
msgstr "Имя класса миграции `M251102141707Page` генерируется автоматически, поэтому замените суффикс `Page` на фактическое имя миграции. Префикс `M251102141707` необходим для поиска и сортировки миграций в порядке их добавления."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Note that we use UUID as the primary key. We are going to generate these IDs ourselves instead of relying on database so we'll need an extra compose package for that."
msgstr "Обратите внимание, что мы используем UUID в качестве первичного ключа. Мы собираемся генерировать эти идентификаторы самостоятельно, вместо того чтобы полагаться на базу данных, для этого нам понадобится добавить дополнительный пакет composer."

#. type: Fenced code block (shell)
#: ../src/guide/start/databases.md
#, no-wrap
msgid "make composer require ramsey/uuid\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "While the storage space is a bit bigger than using int, the workflow with such IDs is beneficial. Since you generate the ID yourself so you can define a set of related data and save it in a single transaction.  The entities that define this set of data in the code are often called an \"aggregate\"."
msgstr "Хотя объем хранилища немного больше, чем при использовании int, работа с такими идентификаторами имеет свои преимущества. Поскольку идентификатор генерируется самостоятельно, можно определить набор связанных данных и сохранить его в одной транзакции. Сущности, которые определяют этот набор данных в коде, часто называются \"агрегатом\"."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Apply the migration with `make yii migrate:up`."
msgstr "Примените миграцию с помощью `make yii migrate:up`."

#. type: Title ##
#: ../src/guide/start/databases.md
#, no-wrap
msgid "An entity"
msgstr "Сущность"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Now that you have a table it is time to define an entity in the code. Create `src/Web/Page/Page.php`:"
msgstr "Теперь, когда таблица создана, необходимо определить сущность в коде. Создайте файл `src/Web/Page/Page.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"namespace App\\Web\\Page;\n"
"\n"
"use DateTimeImmutable;\n"
"use Yiisoft\\Strings\\Inflector;\n"
"\n"
"final readonly class Page\n"
"{\n"
"    private function __construct(\n"
"        public string $id,\n"
"        public string $title,\n"
"        public string $text,\n"
"        public DateTimeImmutable $createdAt,\n"
"        public DateTimeImmutable $updatedAt,\n"
"    ) {}\n"
"\n"
"    public static function create(\n"
"        string $id,\n"
"        string $title,\n"
"        string $text,\n"
"        ?DateTimeImmutable $createdAt = null,\n"
"        ?DateTimeImmutable $updatedAt = null,\n"
"    ): self {\n"
"        return new self(\n"
"            id: $id,\n"
"            title: $title,\n"
"            text: $text,\n"
"            createdAt: $createdAt ?? new DateTimeImmutable(),\n"
"            updatedAt: $updatedAt ?? new DateTimeImmutable(),\n"
"        );\n"
"    }\n"
"\n"
"    public function getSlug(): string\n"
"    {\n"
"        return (new Inflector())->toSlug($this->title);\n"
"    }\n"
"}\n"
msgstr ""

#. type: Bullet: '- '
#: ../src/guide/start/databases.md ../src/guide/structure/domain.md
#: ../src/guide/structure/service.md
#, no-wrap
msgid "Repository"
msgstr "Репозиторий"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Now that we have entity, we need a place for methods to save an entity, delete it and select either a single page or multiple pages."
msgstr "Теперь, когда сущность создана, необходимо место для методов сохранения, удаления и выборки одной или нескольких страниц."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Create `src/Web/Page/PageRepository.php`:"
msgstr "Создайте файл `src/Web/Page/PageRepository.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"namespace App\\Web\\Page;\n"
"\n"
"use DateTimeImmutable;\n"
"use Yiisoft\\Db\\Connection\\ConnectionInterface;\n"
"use Yiisoft\\Db\\Query\\Query;\n"
"\n"
"final readonly class PageRepository\n"
"{\n"
"    public function __construct(\n"
"        private ConnectionInterface $connection,\n"
"    ) {}\n"
"\n"
"    public function save(Page $page): void\n"
"    {\n"
"        $data = [\n"
"            'id' => $page->id,\n"
"            'title' => $page->title,\n"
"            'slug' => $page->getSlug(),\n"
"            'text' => $page->text,\n"
"            'created_at' => $page->createdAt,\n"
"            'updated_at' => $page->updatedAt,\n"
"        ];\n"
"\n"
"        if ($this->exists($page->id)) {\n"
"            $this->connection->createCommand()->update('{{%page}}', $data, ['id' => $page->id])->execute();\n"
"        } else {\n"
"            $this->connection->createCommand()->insert('{{%page}}', $data)->execute();\n"
"        }\n"
"    }\n"
"\n"
"    public function findOneBySlug(string $slug): ?Page\n"
"    {\n"
"        $query = $this->connection\n"
"            ->select()\n"
"            ->from('{{%page}}')\n"
"            ->where('slug = :slug', ['slug' => $slug]);\n"
"\n"
"        return $this->createPage($query->one());\n"
"    }\n"
"\n"
"    /**\n"
"     * @return iterable<Page>\n"
"     */\n"
"    public function findAll(): iterable\n"
"    {\n"
"        $data = $this->connection\n"
"            ->select()\n"
"            ->from('{{%page}}')\n"
"            ->all();\n"
"\n"
"        foreach ($data as $page) {\n"
"            yield $this->createPage($page);\n"
"        }\n"
"    }\n"
"\n"
"    private function createPage(?array $data): ?Page\n"
"    {\n"
"        if ($data === null) {\n"
"            return null;\n"
"        }\n"
"\n"
"        return Page::create(\n"
"            id: $data['id'],\n"
"            title: $data['title'],\n"
"            text: $data['text'],\n"
"            createdAt: new DateTimeImmutable($data['created_at']),\n"
"            updatedAt: new DateTimeImmutable($data['updated_at']),\n"
"        );\n"
"    }\n"
"\n"
"    public function deleteBySlug(string $slug): void\n"
"    {\n"
"        $this->connection->createCommand()->delete(\n"
"            '{{%page}}',\n"
"            ['slug' => $slug],\n"
"        )->execute();\n"
"    }\n"
"\n"
"    public function exists(string $id): bool\n"
"    {\n"
"        return $this->connection->createQuery()\n"
"            ->from('{{%page}}')\n"
"            ->where(['id' => $id])\n"
"            ->exists();\n"
"    }\n"
"}\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "In this repository there are both methods to get data and `save()` to do insert or update. DB returns raw data as arrays but our repository automatically creates entities from this raw data so later we operate typed data."
msgstr "В этом репозитории есть методы для получения данных и метод `save()` для вставки или обновления записей. База данных возвращает необработанные данные в виде массивов, но репозиторий автоматически создает из них сущности, что позволяет в дальнейшем работать с типизированными данными."

#. type: Title ##
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Actions and routes"
msgstr "Действия и маршруты"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "We need some actions to:"
msgstr "Необходимо создать действия для:"

#. type: Bullet: '1. '
#: ../src/guide/start/databases.md
msgid "List all pages."
msgstr "Вывести список всех страниц."

#. type: Bullet: '2. '
#: ../src/guide/start/databases.md
msgid "View a page."
msgstr "Просмотреть страницу."

#. type: Bullet: '3. '
#: ../src/guide/start/databases.md
msgid "Delete a page."
msgstr "Удалить страницу."

#. type: Bullet: '4. '
#: ../src/guide/start/databases.md
msgid "Create a page."
msgstr "Создать страницу."

#. type: Bullet: '5. '
#: ../src/guide/start/databases.md
msgid "Update a page."
msgstr "Обновить страницу."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Then we need routing for all these."
msgstr "Затем необходимо настроить маршрутизацию для всех этих действий."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Let's tackle these one by one."
msgstr "Рассмотрим их по очереди."

#. type: Title ###
#: ../src/guide/start/databases.md
#, fuzzy, no-wrap
#| msgid "Install the package"
msgid "List all pages"
msgstr "Вывести список всех страниц"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Create `src/Web/Page/ListAction.php`:"
msgstr "Создайте файл `src/Web/Page/ListAction.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"namespace App\\Web\\Page;\n"
"\n"
"use Psr\\Http\\Message\\ResponseInterface;\n"
"use Yiisoft\\Yii\\View\\Renderer\\ViewRenderer;\n"
"\n"
"final readonly class ListAction\n"
"{\n"
"    public function __construct(\n"
"        private ViewRenderer $viewRenderer,\n"
"        private PageRepository $pageRepository,\n"
"    )\n"
"    {\n"
"    }\n"
"\n"
"    public function __invoke(): ResponseInterface\n"
"    {\n"
"        return $this->viewRenderer->render(__DIR__ . '/list', [\n"
"            'pages' => $this->pageRepository->findAll(),\n"
"        ]);\n"
"    }\n"
"}\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Define list view in `src/Web/Page/list.php`:"
msgstr "Создайте представление списка в файле `src/Web/Page/list.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"use App\\Web\\Page\\Page;\n"
"use Yiisoft\\Html\\Html;\n"
"use Yiisoft\\Router\\UrlGeneratorInterface;\n"
"\n"
"/** @var iterable<Page> $pages */\n"
"/** @var UrlGeneratorInterface $urlGenerator */\n"
"?>\n"
"\n"
"<ul>\n"
"    <?php foreach ($pages as $page): ?>\n"
"    <li>\n"
"        <?= Html::a($page->title, $urlGenerator->generate('page/view', ['slug' => $page->getSlug()])) ?>\n"
"    </li>\n"
"    <?php endforeach ?>\n"
"</ul>\n"
"\n"
"<?= Html::a('Create', $urlGenerator->generate('page/edit', ['slug' => 'new'])) ?>\n"
msgstr ""

#. type: Title ###
#: ../src/guide/start/databases.md
#, no-wrap
msgid "View a page"
msgstr "Просмотр страницы"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Create `src/Web/Page/ViewAction.php`:"
msgstr "Создайте файл `src/Web/Page/ViewAction.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"namespace App\\Web\\Page;\n"
"\n"
"use Psr\\Http\\Message\\ResponseFactoryInterface;\n"
"use Psr\\Http\\Message\\ResponseInterface;\n"
"use Yiisoft\\Http\\Status;\n"
"use Yiisoft\\Router\\HydratorAttribute\\RouteArgument;\n"
"use Yiisoft\\Yii\\View\\Renderer\\ViewRenderer;\n"
"\n"
"final readonly class ViewAction\n"
"{\n"
"    public function __construct(\n"
"        private ViewRenderer $viewRenderer,\n"
"        private PageRepository $pageRepository,\n"
"        private ResponseFactoryInterface $responseFactory,\n"
"    ) {}\n"
"\n"
"    public function __invoke(\n"
"        #[RouteArgument('slug')]\n"
"        string $slug,\n"
"    ): ResponseInterface {\n"
"        $page = $this->pageRepository->findOneBySlug($slug);\n"
"        if ($page === null) {\n"
"            return $this->responseFactory->createResponse(Status::NOT_FOUND);\n"
"        }\n"
"\n"
"        return $this->viewRenderer->render(__DIR__ . '/view', [\n"
"            'page' => $page,\n"
"        ]);\n"
"    }\n"
"}\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Now, a template in `src/Web/Page/view.php`:"
msgstr "Теперь создайте шаблон в файле `src/Web/Page/view.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"use App\\Web\\Page\\Page;\n"
"use Yiisoft\\Html\\Html;\n"
"use Yiisoft\\Router\\UrlGeneratorInterface;\n"
"use Yiisoft\\Yii\\View\\Renderer\\Csrf;\n"
"\n"
"/** @var Page $page */\n"
"/** @var UrlGeneratorInterface $urlGenerator */\n"
"/* @var Csrf $csrf */\n"
"?>\n"
"\n"
"<h1><?= Html::a('Pages', $urlGenerator->generate('page/list')) ?> → <?= Html::encode($page->title) ?></h1>\n"
"\n"
"<p>\n"
"    <?= Html::encode($page->text) ?>\n"
"</p>\n"
"\n"
"<?= Html::a('Edit', $urlGenerator->generate('page/edit', ['slug' => $page->getSlug()])) ?> |\n"
"\n"
"\n"
"<?php\n"
"    $deleteForm = Html::form()\n"
"        ->post($urlGenerator->generate('page/delete', ['slug' => $page->getSlug()]))\n"
"        ->csrf($csrf);\n"
"?>\n"
"<?= $deleteForm->open() ?>\n"
"    <?= Html::submitButton('Delete') ?>\n"
"<?= $deleteForm->close() ?>\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "In this view we have a form that submits a request for page deletion. Handing it with `GET` is common as well, but it is very wrong. Since deletion changes data, it needs to be handled by one of the non-idempotent HTTP methods.  We use POST and a form in our example, but it could be `DELETE` and async request made with JavaScript.  The button could be later styled properly to look similar to the \"Edit\"."
msgstr "В этом представлении есть форма, которая отправляет запрос на удаление страницы. Обработка таких запросов через `GET` тоже встречается, но это неправильно. Поскольку удаление изменяет данные, оно должно обрабатываться одним из неидемпотентных HTTP-методов. В нашем примере используется POST и форма, но это может быть и `DELETE` с асинхронным запросом на JavaScript. Кнопку можно позже стилизовать, чтобы она выглядела похоже на \"Редактировать\"."

#. type: Title ###
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Delete a page"
msgstr "Удаление страницы"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Create `src/Web/Page/DeleteAction.php`:"
msgstr "Создайте файл `src/Web/Page/DeleteAction.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"namespace App\\Web\\Page;\n"
"\n"
"use Psr\\Http\\Message\\ResponseFactoryInterface;\n"
"use Psr\\Http\\Message\\ResponseInterface;\n"
"use Yiisoft\\Http\\Status;\n"
"use Yiisoft\\Router\\HydratorAttribute\\RouteArgument;\n"
"use Yiisoft\\Router\\UrlGeneratorInterface;\n"
"\n"
"final readonly class DeleteAction\n"
"{\n"
"    public function __construct(\n"
"        private PageRepository $pageRepository,\n"
"        private ResponseFactoryInterface $responseFactory,\n"
"        private UrlGeneratorInterface $urlGenerator,\n"
"    ) {}\n"
"\n"
"    public function __invoke(\n"
"        #[RouteArgument('slug')]\n"
"        string $slug\n"
"    ): ResponseInterface\n"
"    {\n"
"        $this->pageRepository->deleteBySlug($slug);\n"
"\n"
"        return $this->responseFactory\n"
"            ->createResponse(Status::SEE_OTHER)\n"
"            ->withHeader('Location', $this->urlGenerator->generate('page/list'));\n"
"    }\n"
"}\n"
msgstr ""

#. type: Title ###
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Create or update a page"
msgstr "Создание или обновление страницы"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "First of all, we need a form at `src/Web/Page/Form.php`:"
msgstr "Прежде всего, необходимо создать форму в файле `src/Web/Page/Form.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"namespace App\\Web\\Page;\n"
"\n"
"use Yiisoft\\FormModel\\FormModel;\n"
"use Yiisoft\\Validator\\Label;\n"
"use Yiisoft\\Validator\\Rule\\Length;\n"
"\n"
"final class Form extends FormModel\n"
"{\n"
"    #[Label('Title')]\n"
"    #[Length(min: 2)]\n"
"    public string $title = '';\n"
"\n"
"    #[Label('Text')]\n"
"    #[Length(min: 2)]\n"
"    public string $text = '';\n"
"}\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Then an action. Create `src/Web/Page/EditAction.php`:"
msgstr "Затем создайте действие в файле `src/Web/Page/EditAction.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"namespace App\\Web\\Page;\n"
"\n"
"use DateTimeImmutable;\n"
"use Psr\\Http\\Message\\ResponseFactoryInterface;\n"
"use Psr\\Http\\Message\\ResponseInterface;\n"
"use Psr\\Http\\Message\\ServerRequestInterface;\n"
"use Ramsey\\Uuid\\Uuid;\n"
"use Yiisoft\\FormModel\\FormHydrator;\n"
"use Yiisoft\\Http\\Status;\n"
"use Yiisoft\\Router\\HydratorAttribute\\RouteArgument;\n"
"use Yiisoft\\Router\\UrlGeneratorInterface;\n"
"use Yiisoft\\Yii\\View\\Renderer\\ViewRenderer;\n"
"\n"
"final readonly class EditAction\n"
"{\n"
"    public function __construct(\n"
"        private ViewRenderer $viewRenderer,\n"
"        private FormHydrator $formHydrator,\n"
"        private ResponseFactoryInterface $responseFactory,\n"
"        private UrlGeneratorInterface $urlGenerator,\n"
"    ) {}\n"
"\n"
"    public function __invoke(\n"
"        #[RouteArgument('slug')]\n"
"        string $slug,\n"
"        ServerRequestInterface $request,\n"
"        PageRepository $pageRepository,\n"
"    ): ResponseInterface\n"
"    {\n"
"        $isNew = $slug === 'new';\n"
"\n"
"        $form = new Form();\n"
"\n"
"        if (!$isNew) {\n"
"            $page = $pageRepository->findOneBySlug($slug);\n"
"            if ($page === null) {\n"
"                return $this->responseFactory->createResponse(Status::NOT_FOUND);\n"
"            }\n"
"\n"
"            $form->title = $page->title;\n"
"            $form->text = $page->text;\n"
"        }\n"
"\n"
"        $this->formHydrator->populateFromPostAndValidate($form, $request);\n"
"\n"
"        if ($form->isValid()) {\n"
"            $id = $isNew ? Uuid::uuid7()->toString() : $page->id;\n"
"\n"
"            $page = Page::create(\n"
"                id: $id,\n"
"                title: $form->title,\n"
"                text: $form->text,\n"
"                updatedAt: new DateTimeImmutable(),\n"
"            );\n"
"\n"
"            $pageRepository->save($page);\n"
"\n"
"            return $this->responseFactory\n"
"                ->createResponse(Status::SEE_OTHER)\n"
"                ->withHeader(\n"
"                    'Location',\n"
"                    $this->urlGenerator->generate('page/view', ['slug' => $page->getSlug()]),\n"
"                );\n"
"        }\n"
"\n"
"        return $this->viewRenderer->render(__DIR__ . '/edit', [\n"
"            'form' => $form,\n"
"            'isNew' => $isNew,\n"
"            'slug' => $slug,\n"
"        ]);\n"
"    }\n"
"}\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Note that `Uuid::uuid7()->toString()` won't work for MySQL and you'll need bytes instead, `Uuid::uuid7()->getBytes()`.\n"
msgstr "Обратите внимание, что `Uuid::uuid7()->toString()` не будет работать для MySQL, и вам понадобятся байты вместо этого, `Uuid::uuid7()->getBytes()`.\n"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "In the above we use a special slug in the URL for new pages so the URL looks like `http://localhost/pages/new`. If the page isn't new, we pre-fill the form with the data from the database. Similar to how we did in [Working with forms](forms.md), we handle the form submission. After successful save we redirect to the page view."
msgstr "В приведенном выше коде используется специальный slug в URL для новых страниц, чтобы URL выглядел как `http://localhost/pages/new`. Если страница не новая, форма предварительно заполняется данными из базы данных. Аналогично тому, как это было сделано в разделе [Работа с формами](forms.md), обрабатывается отправка формы. После успешного сохранения происходит перенаправление на страницу просмотра."

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Now, a template in `src/Web/Page/edit.php`:"
msgstr "Теперь создайте шаблон в файле `src/Web/Page/edit.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"use App\\Web\\Page\\Form;\n"
"use Yiisoft\\FormModel\\Field;\n"
"use Yiisoft\\Html\\Html;\n"
"use Yiisoft\\Router\\UrlGeneratorInterface;\n"
"use Yiisoft\\Yii\\View\\Renderer\\Csrf;\n"
"\n"
"/**\n"
" * @var Form $form\n"
" * @var string[] $errors\n"
" * @var UrlGeneratorInterface $urlGenerator\n"
" * @var Csrf $csrf\n"
" * @var bool $isNew\n"
" * @var string $slug\n"
" */\n"
"\n"
"$htmlForm = Html::form()\n"
"    ->post($urlGenerator->generate('page/edit', ['slug' => $slug]))\n"
"    ->csrf($csrf);\n"
"?>\n"
"\n"
"<?= $htmlForm->open() ?>\n"
"    <?= Field::text($form, 'title')->required() ?>\n"
"    <?= Field::textarea($form, 'text')->required() ?>\n"
"    <?= Html::submitButton('Save') ?>\n"
"<?= $htmlForm->close() ?>\n"
msgstr ""

#. type: Title ###
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Routing"
msgstr "Маршрутизация"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Adjust `config/common/routes.php`:"
msgstr "Измените файл `config/common/routes.php`:"

#. type: Fenced code block (php)
#: ../src/guide/start/databases.md
#, no-wrap
msgid ""
"<?php\n"
"\n"
"declare(strict_types=1);\n"
"\n"
"use App\\Web;\n"
"use Yiisoft\\Http\\Method;\n"
"use Yiisoft\\Router\\Group;\n"
"use Yiisoft\\Router\\Route;\n"
"\n"
"return [\n"
"    Group::create()\n"
"        ->routes(\n"
"            Route::get('/')\n"
"                ->action(Web\\HomePage\\Action::class)\n"
"                ->name('home'),\n"
"            Route::methods([Method::GET, Method::POST], '/say')\n"
"                ->action(Web\\Echo\\Action::class)\n"
"                ->name('echo/say'),\n"
"\n"
"            Group::create('/pages')->routes(\n"
"                Route::get('')\n"
"                    ->action(Web\\Page\\ListAction::class)\n"
"                    ->name('page/list'),\n"
"                Route::get('/{slug}')\n"
"                    ->action(Web\\Page\\ViewAction::class)\n"
"                    ->name('page/view'),\n"
"                Route::methods([Method::GET, Method::POST], '/{slug}/edit')\n"
"                    ->action(Web\\Page\\EditAction::class)\n"
"                    ->name('page/edit'),\n"
"                Route::post('/{slug}/delete')\n"
"                    ->action(Web\\Page\\DeleteAction::class)\n"
"                    ->name('page/delete'),\n"
"            ),\n"
"        ),\n"
"];\n"
msgstr ""

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Note that we've grouped all page-related routes with a group under `/pages` prefix. That is a convenient way to both not to repeat yourself and add some extra middleware, such as authentication, to the whole group."
msgstr "Обратите внимание, что все маршруты, связанные со страницами, сгруппированы под префиксом `/pages`. Это удобный способ избежать дублирования кода и применить дополнительные обработчики запросов, такие как аутентификация, ко всем маршрутам в группе."

#. type: Title ##
#: ../src/guide/start/databases.md
#, no-wrap
msgid "Trying it out"
msgstr "Проверка работы"

#. type: Plain text
#: ../src/guide/start/databases.md
msgid "Now try it out by opening `http://localhost/pages` in your browser."
msgstr "Теперь проверьте результат, открыв в браузере `http://localhost/pages`."
